@import "tailwindcss";

/* ===========================================================
   THEME CONFIGURATION (Tailwind v4)
   =========================================================== */
@theme {
  /* COLORS: These map your CSS vars to Tailwind utilities */
  --color-bg: var(--bg);
  --color-surface: var(--surface);
  
  /* FIX: Map 'var(--text)' to '--color-body' so 'text-body' works */
  --color-body: var(--text);
  
  --color-muted: var(--muted);
  --color-brand: var(--brand);
  --color-accent: var(--accent);
  --color-success: var(--success);
  --color-danger: var(--danger);
  --color-border: var(--border);
  
  /* SHADOWS & RADIUS */
  --shadow-custom: var(--shadow);
  --radius-custom: var(--radius);
}

/* ===========================================================
   DESIGN TOKENS + BASE
   =========================================================== */
@layer base {
  :root {
    --bg: #ffffff;
    --surface: #f9fafb;
    --text: #1f2937;
    --muted: #6b7280;
    --brand: #3b82f6;
    --accent: #8b5cf6;
    --success: #10b981;
    --danger: #ef4444;
    --border: #e5e7eb;
    --shadow: 0 4px 12px rgba(0,0,0,0.05);
    --glass: rgba(255,255,255,0.8);
    --radius: 0.75rem;
    --loader-start: var(--brand);
    --loader-end: var(--success);
  }

  /* Dark theme */
  .dark {
    --bg: #0f1724;
    --surface: #0b1320;
    --text: #f8fafc;
    --muted: #94a3b8;
    --brand: #60a5fa;
    --accent: #a78bfa;
    --success: #34d399;
    --danger: #f87171;
    --border: #1f2937;
    --shadow: 0 6px 18px rgba(0,0,0,0.45);
    --glass: rgba(17,24,39,0.55);
  }

  html, body {
    background-color: var(--bg);
    color: var(--text);
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    line-height: 1.6;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
}

/* ===========================================================
   GLOBAL DATE PICKER FIX
   =========================================================== */
@layer base {
  input[type="date"] {
    @apply appearance-none;
    background-color: var(--bg) !important;
    color: var(--text) !important;
    border: 1px solid var(--border) !important;
    border-radius: 0.75rem;
    padding: 0.5rem 0.75rem;
  }

  input[type="date"]::-webkit-calendar-picker-indicator {
    opacity: 0.6;
    filter: invert(0.4);
    cursor: pointer;
  }

  input[type="date"]:focus {
    outline: 2px solid var(--brand);
    outline-offset: 2px;
  }

  .dark input[type="date"]::-webkit-calendar-picker-indicator { filter: invert(1); }
}

/* ===========================================================
   COMPONENTS
   =========================================================== */
@layer components {
  /* Card */
  .card {
    /* Now text-body works because --color-body is defined in @theme */
    @apply bg-surface text-body border-surface shadow-custom rounded-[--radius-custom];
    transition: transform .18s ease, box-shadow .18s ease;
    border-width: 1px;
  }

  /* Buttons */
  .btn-primary {
    @apply bg-brand text-white inline-flex items-center gap-2 font-medium rounded-lg py-2.5 px-4 transition-all duration-200;
  }
  .btn-primary:hover { filter: brightness(.95); transform: translateY(-1px); }

  .btn-ghost {
    @apply bg-transparent border border-border text-body py-2 px-3.5 rounded-lg font-medium transition-all duration-200;
  }
  .btn-ghost:hover { 
    background-color: color-mix(in srgb, var(--surface) 95%, black); 
    transform: translateY(-1px); 
  }

  /* Replaced manual styles with @apply where possible for consistency */
  .btn-success { @apply bg-success text-white py-2 px-3.5 rounded-lg font-medium; }
  .btn-danger  { @apply bg-danger text-white py-2 px-3.5 rounded-lg font-medium; }

  .pill {
    @apply inline-block px-3 py-1 rounded-full text-xs font-semibold;
    background-color: color-mix(in srgb, var(--surface) 90%, black);
  }

  .glass {
    background: var(--glass);
    backdrop-filter: blur(8px);
    border-radius: .5rem;
    padding: .75rem;
    border: 1px solid color-mix(in srgb, var(--border) 50%, transparent);
  }

  /* Status Badges */
  .status-badge { @apply inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-semibold capitalize; }
  
  .status-pending   { background: color-mix(in srgb, var(--accent) 10%, transparent); color: var(--accent); border: 1px solid color-mix(in srgb, var(--accent) 20%, transparent); }
  .status-confirmed { background: color-mix(in srgb, var(--brand) 10%, transparent);  color: var(--brand);  border: 1px solid color-mix(in srgb, var(--brand) 20%, transparent); }
  .status-completed { background: color-mix(in srgb, var(--success) 10%, transparent); color: var(--success); border: 1px solid color-mix(in srgb, var(--success) 20%, transparent); }
  .status-cancelled { background: color-mix(in srgb, var(--danger) 10%, transparent);  color: var(--danger);  border: 1px solid color-mix(in srgb, var(--danger) 20%, transparent); }

  /* Skeleton */
  .skeleton { 
    background: linear-gradient(90deg, color-mix(in srgb, var(--surface) 95%, black) 25%, color-mix(in srgb, var(--surface) 90%, black) 50%, color-mix(in srgb, var(--surface) 95%, black) 75%); 
    background-size: 200% 100%; 
    animation: shimmer 1.5s infinite; 
    @apply rounded-md h-4;
  }
  @keyframes shimmer { 0% { background-position: 200% 0 } 100% { background-position: -200% 0 } }

  .glass-card {
    border-radius: var(--radius);
    background: var(--glass);
    backdrop-filter: blur(12px);
    border: 1px solid color-mix(in srgb, var(--border) 20%, transparent);
  }

  .floating-action { box-shadow: 0 10px 25px rgba(0,0,0,.12); transition: transform .26s cubic-bezier(.4,0,.2,1); }
  .floating-action:hover { transform: translateY(-2px); }

  .card-hover { transition: transform .26s cubic-bezier(.4,0,.2,1), box-shadow .26s; }
  .card-hover:hover { transform: translateY(-6px); box-shadow: 0 20px 40px rgba(0,0,0,.1); }
  .dark .card-hover:hover { box-shadow: 0 20px 40px rgba(0,0,0,.35); }

  .status-indicator { position: relative; overflow: hidden; }
  .status-indicator::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,.18), transparent); transition: left .5s ease; }
  .status-indicator.animate::before { left: 100%; }

  .search-active #statsRow, .search-active #sidebarSection { opacity: 0; pointer-events: none; transform: translateY(-20px); transition: all .28s ease; }

  .active-result { background-color: rgba(99,102,241,0.06); outline: 2px solid rgba(99,102,241,0.12); }

  /* Loader Visual */
  #global-loader .loader-card { @apply bg-surface text-body border border-border shadow-custom; }
  #global-loader .loader-backdrop { background: color-mix(in srgb, black 45%, transparent); }
  #global-loader-progress { background: linear-gradient(90deg, var(--loader-start), var(--loader-end)); transition: width 400ms ease-out; }

  /* Search Results */
  #searchResults { 
    @apply bg-surface border border-border rounded-lg shadow-lg overflow-hidden; 
    max-height: 70vh; 
    overflow-y: auto; 
  }
  
  #searchResults > div > a { @apply focus:outline-none; }
  #searchResults a.active-result, #searchResults a:focus { @apply ring-2 ring-brand ring-inset; }

  /* Avatar Gradient */
  .avatar-gradient { background: linear-gradient(135deg, var(--brand), color-mix(in srgb, var(--brand) 60%, var(--accent))); }

  /* Spinner */
  .spinner-primary { @apply inline-block w-[18px] h-[18px] border-[3px] rounded-full animate-spin; border-color: rgba(0,0,0,0.12); border-top-color: currentColor; }
}

/* ===========================================================
   UTILITIES
   =========================================================== */
@layer utilities {
  .lhims-container { max-width: 1100px; margin: 1.5rem auto; padding: 0 1rem; }

  .page-overlay-gradient { background: linear-gradient(180deg, transparent 0%, color-mix(in srgb, var(--bg) 85%, transparent) 60%); pointer-events: none; }

  .site-topbar { background: color-mix(in srgb, var(--bg) 98%, transparent); border-bottom: 1px solid var(--border); }

  /* Mobile Sidebar */
  #mobile-sidebar { @apply bg-surface text-body border-r border-border shadow-custom; }

  footer.site-footer { background: color-mix(in srgb, var(--bg) 85%, transparent); color: var(--muted); border-top: 1px solid var(--border); }

  .site-toast { @apply bg-brand text-white; }

  /* Unread Visual */
  .notif-unread { background: rgba(0,0,0,0.02); font-weight: 600; }
  .opacity-60 { opacity: 0.6 !important; }
}